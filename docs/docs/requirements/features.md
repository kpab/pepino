# ⚙️ 機能詳細仕様

## 🎯 概要

Pepino MVP版で実装する機能の詳細仕様を定義します。

---

## 🏠 ホーム画面

### 機能概要
現在地周辺の「今すぐ参加可能」なオフラインイベントを優先表示する。

### 詳細仕様

#### 表示ロジック
```
優先度計算 = (即時参加可能性 × 3) + (1 / 距離km) + (カテゴリ一致 × 2)

即時参加可能性:
- 現在時刻 < 開始時刻 <= 現在時刻+2時間: 3点
- 現在時刻+2時間 < 開始時刻 <= 現在時刻+6時間: 2点
- 現在時刻+6時間 < 開始時刻: 1点
```

#### UI要素
| 要素 | 表示内容 | 必須/任意 |
|------|-----------|-----------|
| イベント名 | title (最大2行) | 必須 |
| 開催時間 | 「今から○○分後開始」形式 | 必須 |
| 距離・移動時間 | 「徒歩○分」「電車○分」 | 必須 |
| カテゴリ | アイコン+テキスト | 必須 |
| 参加者数 | 「○人参加予定」 | 任意 |
| 料金 | 「無料」「¥○○」 | 必須 |
| イベント画像 | サムネイル | 任意 |

#### 動作仕様
- **初回表示**: 位置情報取得後、5km圏内の今日のイベント表示
- **更新頻度**: 30秒ごとに自動更新
- **エラーハンドリング**: 位置情報取得失敗時は手動設定促進

---

## 🔍 検索・フィルター機能

### 機能概要
ユーザーの条件に合わせたイベント絞り込み・並び替え機能。

### 詳細仕様

#### フィルター項目
| 項目 | 選択肢 | デフォルト |
|------|--------|------------|
| 距離 | 1km/3km/5km/10km/制限なし | 5km |
| 開始時間 | 今から2時間/今日中/今週中/指定なし | 今から2時間 |
| カテゴリ | tech/business/cultural/sports/etc | 全選択 |
| 料金 | 無料のみ/¥1000以下/¥3000以下/指定なし | 指定なし |
| 定員状況 | 参加可能のみ/すべて | 参加可能のみ |

#### 並び替え
| 項目 | 説明 |
|------|------|
| おすすめ順 | 優先度計算によるランキング |
| 距離順 | 近い順 |
| 開始時間順 | 早い順 |
| 料金順 | 安い順 |

#### 検索結果表示
- **表示件数**: 20件/ページ
- **ページング**: 無限スクロール
- **空状態**: 「条件に合うイベントが見つかりません」メッセージ

---

## 📍 位置情報機能

### 機能概要
ユーザーの現在地を取得し、イベント検索の基点とする。

### 詳細仕様

#### 位置取得方法
| 方法 | 精度 | 取得時間 | 使用場面 |
|------|------|----------|----------|
| GPS | 10-50m | 5-15秒 | 屋外・初回取得 |
| Wi-Fi | 50-200m | 2-5秒 | 屋内・高速取得 |
| 手動設定 | 駅単位 | 即座 | GPS拒否・プライバシー重視 |

#### 取得フロー
```
1. ブラウザ位置情報許可確認
2. 許可の場合: GPS取得開始
3. 拒否の場合: 手動設定モーダル表示
4. 取得失敗の場合: 手動設定へフォールバック
5. 取得成功: 位置情報保存 + イベント検索実行
```

#### プライバシー配慮
- **保存期間**: 7日間で自動削除
- **精度調整**: 100m単位で丸める
- **匿名化**: セッションIDベースでユーザー特定なし

---

## 📄 イベント詳細画面

### 機能概要
イベントの詳細情報と参加方法を表示する。

### 詳細仕様

#### 表示情報
| セクション | 情報 | 必須/任意 |
|------------|------|-----------|
| 基本情報 | タイトル、開催日時、場所、料金 | 必須 |
| 詳細説明 | イベント内容、対象者、持ち物 | 必須 |
| 地図・アクセス | Google Maps、最寄り駅、所要時間 | 必須 |
| 参加者情報 | 現在参加者数、定員、参加者属性 | 任意 |
| 主催者情報 | 主催者名、連絡先、過去実績 | 任意 |
| 関連イベント | 同主催者・同カテゴリの他イベント | 任意 |

#### 参加アクション
```
【参加ボタン】
- 外部サイト（connpass等）: 外部リンクに遷移
- 独自イベント: 参加登録フォーム表示

【参加登録フォーム】
- 名前（必須）
- メールアドレス（必須）
- 電話番号（任意）
- 質問・コメント（任意）
```

#### 地図機能
- **地図表示**: Google Maps JavaScript API
- **現在地表示**: ユーザー位置と会場の両方表示
- **ルート案内**: Google Maps アプリ連携
- **交通手段**: 徒歩・電車・車のルート表示

---

## 🎨 UI/UX共通仕様

### デザインシステム

#### カラーパレット
```
プライマリー: #FF6B6B (Pepino Red)
セカンダリー: #4ECDC4 (Mint Green)
アクセント: #45B7D1 (Sky Blue)
背景: #F8F9FA (Light Gray)
テキスト: #2C3E50 (Dark Blue)
```

#### タイポグラフィ
```
見出し1: 24px, Bold, Noto Sans JP
見出し2: 20px, Medium, Noto Sans JP
本文: 16px, Regular, Noto Sans JP
キャプション: 14px, Regular, Noto Sans JP
```

#### アイコンシステム
- **アイコンライブラリ**: Lucide React
- **カテゴリアイコン**: 
  - 💻 tech (Code)
  - 💼 business (Briefcase)
  - 🎨 cultural (Palette)
  - ⚽ sports (Activity)

### レスポンシブ対応
| デバイス | 幅 | レイアウト |
|----------|-------|------------|
| スマートフォン | ~768px | 1カラム、フルスクリーン |
| タブレット | 768-1024px | 1カラム、余白あり |
| デスクトップ | 1024px~ | 2カラム、サイドバー |

---

## 🔐 セキュリティ機能

### 認証・認可（将来実装）
- **ゲストユーザー**: 閲覧・参加のみ
- **登録ユーザー**: イベント作成・管理
- **主催者**: 複数イベント管理・分析

### データ保護
- **位置情報**: 暗号化保存、定期削除
- **個人情報**: 最小限収集、同意ベース
- **セッション**: セキュアクッキー使用

---

## ⚡ パフォーマンス要件

### 応答時間目標
| 操作 | 目標時間 | 測定条件 |
|------|----------|----------|
| 初回画面表示 | <3秒 | 位置情報取得含む |
| イベント検索 | <1秒 | 100件以内の結果 |
| 地図表示 | <2秒 | Google Maps API |
| ページ遷移 | <500ms | SPA内遷移 |

### データ使用量最適化
- **画像**: WebP形式、遅延読み込み
- **API**: 必要なフィールドのみ取得
- **キャッシュ**: 位置情報・検索結果の適切なキャッシュ

---

## 🌐 外部連携機能

### Connpass API連携
```
取得データ:
- イベント基本情報（タイトル、説明、日時）
- 会場情報（住所、緯度経度）
- 参加者情報（定員、現在参加者数）
- 主催者情報（団体名、連絡先）

更新頻度:
- 新着イベント: 1時間ごと
- 参加者数更新: 15分ごと
- イベント詳細更新: 1日1回
```

### Google Maps API連携
```
使用機能:
- Maps JavaScript API: 地図表示
- Geocoding API: 住所→座標変換
- Places API: 会場情報取得
- Directions API: ルート案内
```

---

## 📊 分析・改善機能

### イベント分析
- **人気度指標**: 閲覧数、参加率、お気に入り数
- **地域分析**: エリア別イベント密度、参加率
- **時間分析**: 曜日・時間帯別の人気度

### ユーザー行動分析
- **検索パターン**: よく使われるフィルター組み合わせ
- **参加傾向**: カテゴリ別参加率、リピート率
- **離脱ポイント**: 画面遷移での離脱分析

---

## 📚 機能の優先度

### MVP (Phase 1)
- ✅ ホーム画面（基本表示）
- ✅ 位置情報取得
- 🔄 検索・フィルター（基本機能）
- ⏳ イベント詳細画面
- ⏳ Connpass API連携

### Phase 2
- ⏳ ユーザー登録・ログイン
- ⏳ お気に入り機能
- ⏳ プッシュ通知
- ⏳ イベント作成機能

### Phase 3
- ⏳ ソーシャル機能（コメント・レビュー）
- ⏳ 主催者向け分析ダッシュボード
- ⏳ 他プラットフォーム連携拡大

---

## 📚 関連ドキュメント

- [ユーザーペルソナ](./user-personas)
- [非機能要件](./non-functional)
- [データベース設計](../design/database)
- [API設計](../design/api-spec)

---

## 🔄 更新履歴

| 日付 | 変更内容 | 更新者 |
|------|----------|--------|
| 2025/6/18 | 初版作成（MVP機能詳細化） | Claude |

次回更新予定: Phase 2 開発開始時